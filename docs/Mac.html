<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Step-by-step for Mac</title>
    <style type="text/css">
        body {
            font-family: sans-serif;
        }

        ol li ol {
            list-style-type: lower-alpha;
        }
    </style>
</head>
<body>
    <p>
        This guide assumes you have completed on-boarding and cloned the <a href="https://github.com/twitchdev/developer-rig">
            developer rig repository
        </a> and nothing else.
    </p>
    <ol>
        <li>
            Install all dependencies.  (It is possible to use <strong>brew</strong> for all of these but it will want to install
            version 10 of Node which causes some developer rig dependencies to fail to install.)<ol>
                <li>
                    <a href="https://nodejs.org/dist/v8.11.2/node-v8.11.2.pkg">Node LTS</a>.  If you already have Node
                    installed, it must be at least version 6.
                </li>
                <li><a href="https://yarnpkg.com/lang/en/docs/install">Yarn</a>.</li>
                <li><a href="https://www.python.org/ftp/python/2.7.15/python-2.7.15-macosx10.9.pkg">Python 2</a>.</li>
                <li><a href="https://git-scm.com/download/mac">Git</a>.</li>
            </ol>
        </li>
        <li>
            Add <code>127.0.0.1 localhost.rig.twitch.tv</code> to <code>/etc/hosts</code>.<ol>
                <li>Open a terminal window.</li>
                <li>Execute <code>echo '127.0.0.1 localhost.rig.twitch.tv' | sudo tee -a /etc/hosts</code>.</li>
            </ol>
        </li>
        <li>
            Create the extension at Twitch.<ol>
                <li>Visit <a href="https://dev.twitch.tv/dashboard/extensions">https://dev.twitch.tv/dashboard/extensions</a>.</li>
                <li>Click <strong>Create Extension</strong>.</li>
                <li>Provide all requested information about your new extension and click <strong>Create Extension</strong>.</li>
                <li>
                    Keep this browser session open since you'll need some of the data on it to create a configuration file
                    later.<br />
                    Note that you didn't actually create an extension.  What you did was create Twitch's awareness of your
                    extension (i.e., an internal manifest for your extension).
                </li>
            </ol>
        </li>
        <li>
            Open a terminal window and execute these commands in a directory of your choosing.
            <ol>
                <li><code>git clone https://github.com/twitchdev/developer-rig</code></li>
                <li><code>cd developer-rig</code></li>
                <li><code>yarn install</code> # This takes about half a minute.</li>
                <li>
                    <code>
                        cat &gt; ../config.json &lt;&lt; EOF<br />
                        {<br />
                        &nbsp; "clientID": "<em>your client ID</em>",<br />
                        &nbsp; "version": "0.0.1",<br />
                        &nbsp; "channel": "rig-<em>your Twitch user name</em>",<br />
                        &nbsp; "ownerName": "<em>your Twitch user name</em>"<br />
                        }<br />
                        EOF
                    </code><br />
                    # Your client ID is available in the <strong>Overview</strong> tab of your extension.  Your Twitch user name is
                    displayed in the top-right corner of twitch.tv when you are signed in.
                </li>
                <li>
                    <code>yarn extension-init -l ../my-extension</code><br /># You may replace <code>my-extension</code> with a
                    different directory name.
                </li>
                <li><code>yarn host -l ../my-extension/public -p 8080</code></li>
            </ol>
        </li>
        <li>
            Visit <a href="https://localhost.rig.twitch.tv:8080/viewer.html">https://localhost.rig.twitch.tv:8080/viewer.html</a>.
            If necessary, allow the certificate.  You will see <strong>Hello, World!</strong> in the browser window.
        </li>
        <li>
            Open another terminal window and execute these commands in the same directory as above.<ol>
                <li><code>cd my-extension</code></li>
                <li><code>npm install</code></li>
                <li><code>npm run cert</code></li>
                <li>
                    <code>
                        curl -H 'Client-ID: <em>your client ID</em>' -X GET
                        'https://api.twitch.tv/helix/users?login=<em>your Twitch user name</em>' |
                        sed -e 's/.*"id":"//' -e 's/".*//'
                    </code><br />
                    # This will print your Twitch user ID for the next step.
                </li>
                <li>
                    <code>
                        node services/backend -c '<em>your client ID</em>' -s '<em>your extension secret</em>' -o
                        '<em>your Twitch user ID</em>'
                    </code><br />
                    Your extension secret is in the <strong>Secret Keys</strong> section in the <strong>Settings</strong> tab of
                    your extension.
                </li>
            </ol>
        </li>
        <li>
            Visit <a href="https://localhost:8081">https://localhost:8081</a>.  If necessary, allow the certificate.  You will see
            some JSON describing a 404 response.
        </li>
        <li>
            Open another terminal window and execute these commands in the same directory as above.<ol>
                <li><code>cd developer-rig</code></li>
                <li><code>yarn start -s '<em>your extension secret</em>' -c ../config.json</code></li>
            </ol>
        </li>
        <li>
            This will open <a href="https://localhost.rig.twitch.tv:3000/">https://localhost.rig.twitch.tv:3000/</a>.  If
            necessary, allow the certificate.  What you see is the developer rig with no extension views.
        </li>
        <li>
            Make the required configuration changes.<ol>
                <li>Go back to your dev.twitch.tv browser session.</li>
                <li>Click the <strong>Versions</strong> tab then click <strong>Manage</strong>.</li>
                <li>Click <strong>Asset Hosting</strong>.</li>
                <li>
                    Change <strong>Testing Base URI</strong> from <code>https://localhost:8080/</code> to
                    <code>https://localhost.rig.twitch.tv:8080/</code>.
                </li>
                <li>Change <strong>Panel Viewer Path</strong> from <code>panel.html</code> to <code>viewer.html</code>.</li>
                <li>Click <strong>Save Changes</strong>.</li>
                <li>Go back to your developer rig browser session.</li>
                <li>Click <code>Configurations</code>.  The <strong>Dev Rig Configurations</strong> dialog will open.</li>
                <li>
                    Verify the <code>viewer_url</code> is <code>https://localhost.rig.twitch.tv:8080/viewer.html</code>.  Since it
                    might take a while for the change to take effect as it propagates through Twitch's internal systems, click
                    <strong>Refresh</strong> until you see the change.
                </li>
                <li>Click <strong>Cancel</strong>.</li>
            </ol>
        </li>
        <li>
            Verify the rig is working.<ol>
                <li>Click the <strong>+</strong> button.  The <strong>Add a new view</strong> panel will appear.</li>
                <li>
                    Select the <strong>Broadcaster</strong> viewer type and click <strong>Save</strong>.  The Broadcaster view will
                    appear.
                </li>
                <li>
                    Click <strong>Yes, I would</strong>.  Verify the color changes and there is output to match that request in the
                    second Git Bash shell.
                </li>
                <li>Click the <strong>+</strong> button again.  The <strong>Add a new view</strong> panel will appear.</li>
                <li>
                    Select the <strong>Logged-Out Viewer</strong> viewer type and click <strong>Save</strong>.  The Logged-Out
                    Viewer view will appear.
                </li>
                <li>
                    Click <strong>Yes, I would</strong>.  Verify the color changes in both views and there is output to match that
                    request in the second Git Bash shell.
                </li>
            </ol>
        </li>
    </ol>
    <h3>Issues</h3>
    <p>
        Some browser extensions (e.g. noscript) prevent these endpoints from working. Configure them as necessary to allow access
        to these endpoints. If you are using Firefox, consider creating a profile specifically for the developer rig that has no
        browser extensions.
    </p>
    <p>
        <div><em>I see a browser certificate warning.</em></div>
        <div>
            You need to allow the certificate.  How you do so varies by browser.  Consider allowing it permanently so you won't
            have to allow it every time you run the rig.
        </div>
    </p>
    <p>
        <div>
            <em>
                When I click the <strong>+</strong> button and add the <strong>Broadcaster</strong> viewer type, I see an empty
                box.
            </em>
        </div>
        <div>You need to allow the certificate for the viewer.  See step 5 above.</div>
    </p>
    <p>
        <div>
            <em>
                When I add the <strong>Broadcaster</strong> viewer type or when I click the <strong>Yes, I would</strong> button, I
                see <strong>EBS request returned (error)</strong> messages in the rig console.
            </em>
        </div>
        <div>You need to allow the certificate for the EBS.  See step 7 above.</div>
    </p>
    <p>
        <div>
            <em>
                I changed the <strong>channel</strong> in the configuration and now the color updates only in the view in which I
                clicked the <strong>Yes, I would</strong> button.
            </em>
        </div>
        <div>
            This is a known issue.  Currently, once you create your extension and start using a channel, you may not change it to a
            different one.  If, after changing it back, you still experience this issue, clear the local storage for the developer
            rig in your browser.  This will necessitate recreating the views in the rig.
        </div>
    </p>
    <p>
        <div><em>I see <strong>EBS request returned Too Many Requests (error)</strong> messages in the rig console.</em></div>
        <div>
            Twitch uses rate limiting to prevent overloading our systems.  Your EBS and your extension will need to account for
            this and other HTTP errors.
        </div>
    </p>
</body>
</html>
